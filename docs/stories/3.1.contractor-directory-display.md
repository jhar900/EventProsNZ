# Story 3.1: Contractor Directory Display

## Status

Draft

## Story

**As an** event manager,  
**I want** to browse a comprehensive list of contractors,  
**so that** I can discover potential service providers for my events.

## Acceptance Criteria

1. Contractor card layout with essential information (name, services, location, rating)
2. Grid and list view options for contractor display
3. Pagination and infinite scroll functionality
4. Contractor profile photos and business logos (just main logo/profile picture for card)
5. Service type badges and pricing indicators
6. Review count and average rating display
7. Quick contact and "Get in touch" buttons
8. Responsive design for mobile and desktop
9. Approved contractors only with premium profiles displayed first
10. Premium profile prominence (larger cards, special badges, etc.)

## Tasks / Subtasks

- [ ] Create contractor directory API routes (AC: 1, 3, 9, 10)
  - [ ] Implement `/api/contractors` endpoint for contractor listing
  - [ ] Implement `/api/contractors/search` endpoint for contractor search
  - [ ] Implement `/api/contractors/{id}` endpoint for contractor details
  - [ ] Implement `/api/contractors/featured` endpoint for premium contractors
  - [ ] Add proper filtering for approved contractors only
  - [ ] Add premium profile prioritization logic
- [ ] Build contractor directory UI components (AC: 1, 2, 4, 5, 6, 7, 8, 10)
  - [ ] Create `ContractorDirectory` component with main directory interface
  - [ ] Create `ContractorCard` component for individual contractor display
  - [ ] Create `ContractorGrid` component for grid view layout
  - [ ] Create `ContractorList` component for list view layout
  - [ ] Create `ViewToggle` component for grid/list view switching
  - [ ] Create `PaginationControls` component for pagination
  - [ ] Create `InfiniteScroll` component for infinite scroll
  - [ ] Add responsive design and mobile optimization
- [ ] Implement contractor card layout (AC: 1, 4, 5, 6, 7, 10)
  - [ ] Create contractor card with essential information display
  - [ ] Add profile photo and business logo display
  - [ ] Implement service type badges and categorization
  - [ ] Add pricing indicators and range display
  - [ ] Create review count and rating display
  - [ ] Add quick contact and "Get in touch" buttons
  - [ ] Implement premium profile prominence features
- [ ] Set up pagination and infinite scroll (AC: 3)
  - [ ] Implement pagination with page controls
  - [ ] Add infinite scroll functionality
  - [ ] Create loading states for pagination
  - [ ] Add scroll-to-top functionality
  - [ ] Implement pagination state management
- [ ] Create contractor directory pages and navigation (AC: 8, 9)
  - [ ] Create `/contractors` page with directory display
  - [ ] Create `/contractors/[id]` page for contractor details
  - [ ] Add directory navigation and breadcrumbs
  - [ ] Implement contractor directory routing
  - [ ] Add directory page metadata and SEO
- [ ] Implement premium profile features (AC: 9, 10)
  - [ ] Create premium profile identification logic
  - [ ] Add premium profile visual prominence
  - [ ] Implement premium profile sorting priority
  - [ ] Create premium profile badges and indicators
  - [ ] Add premium profile special features
- [ ] Set up contractor data management (AC: 1, 5, 6)
  - [ ] Create contractor data fetching and caching
  - [ ] Implement contractor rating calculation
  - [ ] Add service type categorization
  - [ ] Create pricing range formatting
  - [ ] Add contractor status validation
- [ ] Implement responsive design (AC: 8)
  - [ ] Create mobile-optimized contractor cards
  - [ ] Add tablet and desktop responsive layouts
  - [ ] Implement responsive grid and list views
  - [ ] Add mobile navigation and controls
  - [ ] Create responsive pagination controls

## Dev Notes

### Previous Story Insights

This story builds on:

- **Story 1.1**: Project setup with Next.js and Supabase integration
- **Story 1.2**: Database schema with user tables and role management
- **Story 1.3**: Authentication system with role-based access
- **Story 1.4**: Basic user management with admin functionality
- **Story 1.5**: Basic UI framework and navigation
- **Story 2.1**: Event manager onboarding (for user context)
- **Story 2.2**: Contractor onboarding (for contractor data)
- **Story 2.3**: Profile management system (for profile data)
- **Story 2.4**: User verification workflow (for approved contractors)

The contractor directory will use the existing database schema and verification system to display approved contractors with comprehensive information.

### Data Models

[Source: architecture/data-models.md#user]
The contractor directory system will work with the following data models:

**User Table:**

- `id` UUID (references auth.users)
- `email` TEXT UNIQUE NOT NULL
- `role` user_role ENUM ('event_manager', 'contractor', 'admin')
- `is_verified` BOOLEAN DEFAULT FALSE
- `last_login` TIMESTAMP WITH TIME ZONE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()
- `updated_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Profile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `first_name` TEXT NOT NULL
- `last_name` TEXT NOT NULL
- `phone` TEXT
- `address` TEXT
- `profile_photo_url` TEXT
- `bio` TEXT
- `preferences` JSON

**BusinessProfile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `company_name` TEXT NOT NULL
- `business_address` TEXT
- `nzbn` TEXT
- `description` TEXT
- `service_areas` TEXT[]
- `social_links` JSON
- `is_verified` BOOLEAN DEFAULT FALSE
- `verification_date` TIMESTAMP WITH TIME ZONE
- `subscription_tier` subscription_tier DEFAULT 'essential'

**Service Table:**

- `id` UUID PRIMARY KEY
- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `service_type` TEXT NOT NULL
- `description` TEXT
- `price_range_min` DECIMAL(10,2)
- `price_range_max` DECIMAL(10,2)
- `availability` TEXT
- `is_visible` BOOLEAN DEFAULT TRUE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Review Table (to be created):**

- `id` UUID PRIMARY KEY
- `contractor_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `event_manager_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `rating` INTEGER CHECK (rating >= 1 AND rating <= 5)
- `comment` TEXT
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

### API Specifications

[Source: architecture/api-specification.md#contractor-endpoints]
The contractor directory system will implement the following API endpoints:

**Contractor Directory:**

- `GET /api/contractors`

  - Query: `{ page?, limit?, sort?, view?, premium_only? }`
  - Response: `{ contractors: Contractor[], total: number, page: number, limit: number }`

- `GET /api/contractors/search`

  - Query: `{ q?, service_type?, location?, price_min?, price_max?, rating_min?, page?, limit? }`
  - Response: `{ contractors: Contractor[], total: number, page: number, limit: number }`

- `GET /api/contractors/featured`

  - Response: `{ contractors: Contractor[] }`

- `GET /api/contractors/{id}`
  - Response: `{ contractor: Contractor, profile: Profile, business_profile: BusinessProfile, services: Service[], reviews: Review[] }`

**Contractor Data:**

- `GET /api/contractors/{id}/services`

  - Response: `{ services: Service[] }`

- `GET /api/contractors/{id}/reviews`
  - Query: `{ page?, limit? }`
  - Response: `{ reviews: Review[], total: number, average_rating: number }`

### Component Specifications

[Source: architecture/components.md#feature-specific-components]
The contractor directory system will use the following components:

**Directory Components:**

- `ContractorDirectory` - Main directory interface
- `ContractorCard` - Individual contractor display card
- `ContractorGrid` - Grid view layout
- `ContractorList` - List view layout
- `ViewToggle` - Grid/list view switching
- `PaginationControls` - Pagination controls
- `InfiniteScroll` - Infinite scroll implementation
- `ContractorFilters` - Search and filter controls
- `PremiumBadge` - Premium profile indicator

**Card Features:**

- Responsive design with mobile optimization
- Service type badges and categorization
- Pricing indicators and range display
- Review count and rating display
- Quick contact and "Get in touch" buttons
- Premium profile prominence features

### File Locations

[Source: architecture/components.md#component-hierarchy]
Based on the project structure guide:

- `app/contractors/page.tsx` - Contractor directory page
- `app/contractors/[id]/page.tsx` - Contractor detail page
- `components/features/contractors/` - Contractor directory components
- `components/features/contractors/ContractorDirectory.tsx` - Main directory
- `components/features/contractors/ContractorCard.tsx` - Contractor card
- `components/features/contractors/ContractorGrid.tsx` - Grid view
- `components/features/contractors/ContractorList.tsx` - List view
- `components/features/contractors/ViewToggle.tsx` - View switching
- `components/features/contractors/PaginationControls.tsx` - Pagination
- `components/features/contractors/PremiumBadge.tsx` - Premium indicator
- `lib/contractors/` - Contractor utilities and services
- `lib/contractors/directory-service.ts` - Directory service
- `lib/contractors/rating-service.ts` - Rating calculation service
- `hooks/useContractors.ts` - Contractor data hook
- `stores/contractors.ts` - Contractor state management

### Technical Constraints

[Source: architecture/tech-stack.md + architecture/security.md]

- **Authentication**: Public access for contractor directory
- **Authorization**: Role-based access for contact features
- **Performance**: Optimized queries with pagination and caching
- **Security**: Input validation and sanitization
- **Validation**: Client-side with React Hook Form + Zod, server-side validation
- **Error Handling**: Comprehensive error types and user-friendly messages
- **SEO**: Proper metadata and structured data for search engines

### Premium Profile Features

**Premium Profile Identification:**

- Subscription tier: 'premium' or 'enterprise'
- Verification status: Verified contractors
- Profile completeness: 100% complete profiles
- Portfolio quality: High-quality portfolio items

**Premium Profile Prominence:**

- Larger card size in grid view
- Special premium badges and indicators
- Priority sorting in directory listings
- Enhanced visual styling and branding
- Featured placement in directory

### Responsive Design

**Mobile (320px - 767px):**

- Single column grid layout
- Compact contractor cards
- Touch-friendly buttons and controls
- Swipe gestures for navigation
- Mobile-optimized pagination

**Tablet (768px - 1023px):**

- Two column grid layout
- Medium-sized contractor cards
- Touch and mouse interaction
- Tablet-optimized controls

**Desktop (1024px+):**

- Three column grid layout
- Full-sized contractor cards
- Hover effects and interactions
- Keyboard navigation support
- Advanced filtering options

### Testing

[Source: architecture/testing.md#testing-strategy]
**Testing Standards:**

- **Component Testing**: Jest + React Testing Library for directory components
- **API Testing**: Jest + Supertest for contractor endpoints
- **E2E Testing**: Playwright for complete directory browsing flows
- **Performance Testing**: Test pagination and infinite scroll performance
- **Test File Location**: `__tests__/contractors/` directory
- **Test Scenarios**: Directory display, pagination, view switching, contractor cards, premium features
- **Coverage Requirements**: 80% coverage for contractor directory logic and components

### Performance Considerations

**Directory Optimization:**

- Pagination for large contractor lists
- Infinite scroll for better user experience
- Image optimization for contractor photos
- Lazy loading for non-critical components
- Caching for frequently accessed data

**Search Performance:**

- Efficient database queries with proper indexing
- Search result caching
- Debounced search input
- Optimized filtering algorithms
- Fast pagination and sorting

### State Management

[Source: architecture/components.md#state-management-architecture]
**Contractor Directory State Management:**

```typescript
interface ContractorStore {
  contractors: Contractor[];
  featuredContractors: Contractor[];
  currentContractor: Contractor | null;
  filters: ContractorFilters;
  pagination: PaginationState;
  viewMode: "grid" | "list";
  isLoading: boolean;
  fetchContractors: (filters?: ContractorFilters) => Promise<void>;
  fetchFeaturedContractors: () => Promise<void>;
  fetchContractorDetails: (id: string) => Promise<void>;
  setViewMode: (mode: "grid" | "list") => void;
  updateFilters: (filters: Partial<ContractorFilters>) => void;
  loadMore: () => Promise<void>;
}
```

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2024-09-22 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
