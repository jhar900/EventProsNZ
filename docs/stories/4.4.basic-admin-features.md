# Story 4.4: Basic Admin Features

## Status

Draft

## Story

**As an** admin,  
**I want** to manage user verification and basic platform operations,  
**so that** I can maintain platform quality and security.

## Acceptance Criteria

1. User verification queue and management
2. Contractor approval and rejection workflow
3. User account status management
4. Basic platform analytics dashboard
5. User activity monitoring
6. Content moderation tools
7. System health monitoring
8. Basic reporting and insights
9. Real-time dashboard updates
10. Export functionality for reports
11. Alert system for unusual activity
12. Sortable columns for all data tables

## Tasks / Subtasks

- [ ] Create admin API routes (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11)
  - [ ] Implement `/api/admin/users` endpoint for user management
  - [ ] Implement `/api/admin/verification` endpoint for verification queue
  - [ ] Implement `/api/admin/analytics` endpoint for platform analytics
  - [ ] Implement `/api/admin/activity` endpoint for user activity monitoring
  - [ ] Implement `/api/admin/content` endpoint for content moderation
  - [ ] Implement `/api/admin/system` endpoint for system health monitoring
  - [ ] Implement `/api/admin/reports` endpoint for reporting and insights
  - [ ] Implement `/api/admin/alerts` endpoint for alert system
  - [ ] Add proper admin authentication and authorization
- [ ] Build admin dashboard UI components (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12)
  - [ ] Create `AdminDashboard` component with main admin interface
  - [ ] Create `UserVerificationQueue` component for verification management
  - [ ] Create `UserManagement` component for account status management
  - [ ] Create `PlatformAnalytics` component for analytics dashboard
  - [ ] Create `UserActivityMonitor` component for activity monitoring
  - [ ] Create `ContentModeration` component for content moderation tools
  - [ ] Create `SystemHealthMonitor` component for system monitoring
  - [ ] Create `ReportsInsights` component for reporting and insights
  - [ ] Create `AlertSystem` component for alert management
  - [ ] Add sortable columns for all data tables
- [ ] Implement user verification management (AC: 1, 2)
  - [ ] Create verification queue with pending contractors
  - [ ] Add contractor approval and rejection workflow
  - [ ] Implement verification status tracking
  - [ ] Add verification notifications and alerts
  - [ ] Create verification history and audit trail
  - [ ] Add verification analytics and reporting
- [ ] Set up user account management (AC: 3)
  - [ ] Create user account status management
  - [ ] Add user account suspension and activation
  - [ ] Implement user account deletion and restoration
  - [ ] Add user account activity monitoring
  - [ ] Create user account analytics and reporting
  - [ ] Add user account security monitoring
- [ ] Create platform analytics dashboard (AC: 4, 8, 9)
  - [ ] Create platform metrics and KPIs display
  - [ ] Add user registration and activity analytics
  - [ ] Implement contractor verification analytics
  - [ ] Add search and engagement analytics
  - [ ] Create revenue and subscription analytics
  - [ ] Add real-time dashboard updates
- [ ] Implement user activity monitoring (AC: 5, 11)
  - [ ] Create user activity tracking and logging
  - [ ] Add suspicious activity detection
  - [ ] Implement activity alerts and notifications
  - [ ] Add activity analytics and reporting
  - [ ] Create activity audit trail
  - [ ] Add activity security monitoring
- [ ] Set up content moderation tools (AC: 6)
  - [ ] Create content review and approval system
  - [ ] Add content flagging and reporting
  - [ ] Implement content removal and restoration
  - [ ] Add content moderation analytics
  - [ ] Create content moderation workflow
  - [ ] Add content moderation notifications
- [ ] Create system health monitoring (AC: 7, 11)
  - [ ] Create system performance monitoring
  - [ ] Add database health monitoring
  - [ ] Implement API performance monitoring
  - [ ] Add error tracking and alerting
  - [ ] Create system uptime monitoring
  - [ ] Add system capacity monitoring
- [ ] Implement reporting and insights (AC: 8, 10, 12)
  - [ ] Create comprehensive reporting system
  - [ ] Add data export functionality
  - [ ] Implement report scheduling and automation
  - [ ] Add custom report generation
  - [ ] Create report analytics and insights
  - [ ] Add sortable and filterable data tables
- [ ] Create admin pages and navigation (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12)
  - [ ] Create `/admin` page with main dashboard
  - [ ] Create `/admin/users` page for user management
  - [ ] Create `/admin/verification` page for verification queue
  - [ ] Create `/admin/analytics` page for platform analytics
  - [ ] Create `/admin/activity` page for activity monitoring
  - [ ] Create `/admin/content` page for content moderation
  - [ ] Create `/admin/system` page for system monitoring
  - [ ] Create `/admin/reports` page for reporting
  - [ ] Add admin navigation and breadcrumbs
  - [ ] Implement admin page routing and access control

## Dev Notes

### Previous Story Insights

This story builds on:

- **Story 1.1**: Project setup with Next.js and Supabase integration
- **Story 1.2**: Database schema with user tables and role management
- **Story 1.3**: Authentication system with role-based access
- **Story 1.4**: Basic user management with admin functionality
- **Story 1.5**: Basic UI framework and navigation
- **Story 2.1**: Event manager onboarding (for user context)
- **Story 2.2**: Contractor onboarding (for contractor data)
- **Story 2.3**: Profile management system (for profile data)
- **Story 2.4**: User verification workflow (for verification status)
- **Story 3.1**: Contractor directory display (for contractor data)
- **Story 3.2**: Advanced search & filtering (for search integration)
- **Story 3.3**: Contractor profile pages (for profile integration)
- **Story 3.4**: Search analytics & optimization (for analytics integration)
- **Story 4.1**: Interactive map implementation (for map foundation)
- **Story 4.2**: Map clustering & interaction (for map interactions)
- **Story 4.3**: Proximity filtering & search (for location services)

The basic admin features will use the existing user management and verification systems to provide comprehensive admin capabilities.

### Data Models

[Source: architecture/data-models.md#user]
The admin features system will work with the following data models:

**User Table:**

- `id` UUID (references auth.users)
- `email` TEXT UNIQUE NOT NULL
- `role` user_role ENUM ('event_manager', 'contractor', 'admin')
- `is_verified` BOOLEAN DEFAULT FALSE
- `last_login` TIMESTAMP WITH TIME ZONE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()
- `updated_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Profile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `first_name` TEXT NOT NULL
- `last_name` TEXT NOT NULL
- `phone` TEXT
- `address` TEXT
- `profile_photo_url` TEXT
- `bio` TEXT
- `preferences` JSON

**BusinessProfile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `company_name` TEXT NOT NULL
- `business_address` TEXT
- `nzbn` TEXT
- `description` TEXT
- `service_areas` TEXT[]
- `social_links` JSON
- `is_verified` BOOLEAN DEFAULT FALSE
- `verification_date` TIMESTAMP WITH TIME ZONE
- `subscription_tier` subscription_tier DEFAULT 'essential'

**AdminAction Table (to be created):**

- `id` UUID PRIMARY KEY
- `admin_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `action_type` TEXT NOT NULL
- `target_user_id` UUID REFERENCES users(id)
- `details` JSON
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**SystemAlert Table (to be created):**

- `id` UUID PRIMARY KEY
- `alert_type` TEXT NOT NULL
- `severity` TEXT NOT NULL
- `message` TEXT NOT NULL
- `details` JSON
- `is_resolved` BOOLEAN DEFAULT FALSE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

### API Specifications

[Source: architecture/api-specification.md#admin-endpoints]
The admin features system will implement the following API endpoints:

**User Management:**

- `GET /api/admin/users`

  - Query: `{ page?, limit?, role?, status?, sort? }`
  - Response: `{ users: AdminUser[], total: number, page: number, limit: number }`

- `PUT /api/admin/users/{id}/status`

  - Body: `{ status: 'active' | 'suspended' | 'deleted' }`
  - Response: `{ success: boolean, user: AdminUser }`

- `GET /api/admin/users/{id}/activity`
  - Response: `{ activity: UserActivity[] }`

**Verification Management:**

- `GET /api/admin/verification/queue`

  - Query: `{ status?, priority?, sort? }`
  - Response: `{ verifications: VerificationItem[], total: number }`

- `POST /api/admin/verification/{id}/approve`

  - Body: `{ reason?: string }`
  - Response: `{ success: boolean, verification: VerificationItem }`

- `POST /api/admin/verification/{id}/reject`
  - Body: `{ reason: string, feedback?: string }`
  - Response: `{ success: boolean, verification: VerificationItem }`

**Platform Analytics:**

- `GET /api/admin/analytics/overview`

  - Query: `{ period?, date_from?, date_to? }`
  - Response: `{ metrics: PlatformMetrics, trends: PlatformTrends }`

- `GET /api/admin/analytics/users`

  - Query: `{ period?, date_from?, date_to? }`
  - Response: `{ user_metrics: UserMetrics, user_trends: UserTrends }`

- `GET /api/admin/analytics/contractors`
  - Query: `{ period?, date_from?, date_to? }`
  - Response: `{ contractor_metrics: ContractorMetrics, contractor_trends: ContractorTrends }`

**System Monitoring:**

- `GET /api/admin/system/health`

  - Response: `{ health: SystemHealth, alerts: SystemAlert[] }`

- `GET /api/admin/system/performance`
  - Query: `{ period? }`
  - Response: `{ performance: SystemPerformance, metrics: PerformanceMetrics }`

**Reports and Export:**

- `GET /api/admin/reports/users`

  - Query: `{ format?, date_from?, date_to? }`
  - Response: `{ report: Blob }`

- `GET /api/admin/reports/contractors`
  - Query: `{ format?, date_from?, date_to? }`
  - Response: `{ report: Blob }`

### Component Specifications

[Source: architecture/components.md#feature-specific-components]
The admin features system will use the following components:

**Admin Components:**

- `AdminDashboard` - Main admin dashboard interface
- `UserVerificationQueue` - Verification queue management
- `UserManagement` - User account management
- `PlatformAnalytics` - Platform analytics dashboard
- `UserActivityMonitor` - User activity monitoring
- `ContentModeration` - Content moderation tools
- `SystemHealthMonitor` - System health monitoring
- `ReportsInsights` - Reporting and insights
- `AlertSystem` - Alert management system
- `DataTable` - Sortable data tables
- `ExportButton` - Data export functionality

**Dashboard Features:**

- Real-time updates and notifications
- Comprehensive analytics and reporting
- User management and verification
- System monitoring and alerts
- Content moderation tools
- Export functionality for reports

### File Locations

[Source: architecture/components.md#component-hierarchy]
Based on the project structure guide:

- `app/admin/page.tsx` - Main admin dashboard
- `app/admin/users/page.tsx` - User management
- `app/admin/verification/page.tsx` - Verification queue
- `app/admin/analytics/page.tsx` - Platform analytics
- `app/admin/activity/page.tsx` - Activity monitoring
- `app/admin/content/page.tsx` - Content moderation
- `app/admin/system/page.tsx` - System monitoring
- `app/admin/reports/page.tsx` - Reporting
- `components/features/admin/` - Admin components
- `components/features/admin/AdminDashboard.tsx` - Main dashboard
- `components/features/admin/UserVerificationQueue.tsx` - Verification queue
- `components/features/admin/UserManagement.tsx` - User management
- `components/features/admin/PlatformAnalytics.tsx` - Platform analytics
- `components/features/admin/UserActivityMonitor.tsx` - Activity monitoring
- `components/features/admin/ContentModeration.tsx` - Content moderation
- `components/features/admin/SystemHealthMonitor.tsx` - System monitoring
- `components/features/admin/ReportsInsights.tsx` - Reporting
- `components/features/admin/AlertSystem.tsx` - Alert system
- `components/features/admin/DataTable.tsx` - Sortable data tables
- `lib/admin/` - Admin utilities and services
- `lib/admin/user-management.ts` - User management service
- `lib/admin/verification.ts` - Verification service
- `lib/admin/analytics.ts` - Analytics service
- `lib/admin/monitoring.ts` - Monitoring service
- `hooks/useAdmin.ts` - Admin data hook
- `stores/admin.ts` - Admin state management

### Technical Constraints

[Source: architecture/tech-stack.md + architecture/security.md]

- **Authentication**: Admin-only access with role validation
- **Security**: Secure admin actions and audit logging
- **Performance**: Efficient admin queries and real-time updates
- **Validation**: Input validation and sanitization
- **Error Handling**: Comprehensive error types and user-friendly messages
- **Real-time**: Real-time dashboard updates and notifications
- **Export**: Secure data export with proper formatting

### Admin Security

**Security Features:**

- Admin-only access with role validation
- Audit logging for all admin actions
- Secure user data handling
- Input validation and sanitization
- Rate limiting for admin endpoints
- CSRF protection for admin actions

**Admin Action Flow:**

```typescript
// Example admin service
class AdminService {
  async getUsers(filters: UserFilters): Promise<AdminUser[]>;
  async updateUserStatus(userId: string, status: UserStatus): Promise<void>;
  async approveVerification(
    verificationId: string,
    reason?: string
  ): Promise<void>;
  async rejectVerification(
    verificationId: string,
    reason: string
  ): Promise<void>;
  async getPlatformAnalytics(period: string): Promise<PlatformMetrics>;
  async exportReport(type: string, format: string): Promise<Blob>;
}
```

### Real-time Updates

**Real-time Features:**

- Live dashboard updates
- Real-time notifications
- Live user activity monitoring
- Real-time system health monitoring
- Live alert system
- Real-time verification queue updates

**Real-time Implementation:**

- WebSocket connections for live updates
- Server-sent events for notifications
- Real-time data synchronization
- Live dashboard refresh
- Real-time alert system

### Export Functionality

**Export Features:**

- User data export (CSV, Excel, PDF)
- Contractor data export
- Analytics report export
- System health report export
- Custom report generation
- Scheduled report delivery

**Export Implementation:**

- Secure data export with proper formatting
- Export file generation and download
- Export history and tracking
- Export permission management
- Export data validation

### Testing

[Source: architecture/testing.md#testing-strategy]
**Testing Standards:**

- **Component Testing**: Jest + React Testing Library for admin components
- **API Testing**: Jest + Supertest for admin endpoints
- **E2E Testing**: Playwright for complete admin workflows
- **Security Testing**: Test admin access control and permissions
- **Performance Testing**: Test admin dashboard performance
- **Test File Location**: `__tests__/admin/` directory
- **Test Scenarios**: User management, verification, analytics, monitoring, reporting
- **Coverage Requirements**: 80% coverage for admin logic and components

### Performance Considerations

**Admin Performance:**

- Efficient admin queries with proper indexing
- Real-time updates optimization
- Dashboard performance monitoring
- Export performance optimization
- Mobile admin interface optimization

**Data Management:**

- Admin data caching
- Real-time data synchronization
- Export data processing
- Analytics data aggregation
- System monitoring data collection

### State Management

[Source: architecture/components.md#state-management-architecture]
**Admin State Management:**

```typescript
interface AdminStore {
  users: AdminUser[];
  verifications: VerificationItem[];
  analytics: PlatformMetrics;
  systemHealth: SystemHealth;
  alerts: SystemAlert[];
  reports: Report[];
  isLoading: boolean;
  fetchUsers: (filters: UserFilters) => Promise<void>;
  updateUserStatus: (userId: string, status: UserStatus) => Promise<void>;
  approveVerification: (
    verificationId: string,
    reason?: string
  ) => Promise<void>;
  rejectVerification: (verificationId: string, reason: string) => Promise<void>;
  fetchAnalytics: (period: string) => Promise<void>;
  fetchSystemHealth: () => Promise<void>;
  exportReport: (type: string, format: string) => Promise<Blob>;
}
```

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2024-09-22 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
