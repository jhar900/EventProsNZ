# Story 5.1: Event Creation Wizard

## Status

Draft

## Story

**As an** event manager,  
**I want** to create events through a guided step-by-step process,  
**so that** I can plan my events systematically and receive intelligent recommendations.

## Acceptance Criteria

1. Step 1: Event basics (type, date, location, attendee count, duration)
2. Step 2: Service requirements with AI-powered suggestions
3. Step 3: Budget planning with intelligent recommendations
4. Step 4: Review and submit event details
5. Form validation and error handling
6. Progress bar through the 4-step process
7. Progress saving and draft functionality
8. Pre-built event templates (weddings, corporate, parties) with customization
9. Integration with contractor matching system
10. Event editing after creation with change tracking and version history
11. Change notifications to contractors when event details are modified

## Tasks / Subtasks

- [ ] Create event creation API routes (AC: 1, 2, 3, 4, 7, 9, 10, 11)
  - [ ] Implement `/api/events` endpoint for event CRUD operations
  - [ ] Implement `/api/events/templates` endpoint for event templates
  - [ ] Implement `/api/events/drafts` endpoint for draft management
  - [ ] Implement `/api/events/{id}/versions` endpoint for version history
  - [ ] Implement `/api/events/{id}/notifications` endpoint for change notifications
  - [ ] Implement `/api/events/{id}/matching` endpoint for contractor matching
  - [ ] Add proper event validation and error handling
  - [ ] Add event draft auto-save functionality
- [ ] Build event creation wizard UI components (AC: 1, 2, 3, 4, 5, 6, 7, 8, 10, 11)
  - [ ] Create `EventCreationWizard` component with 4-step process
  - [ ] Create `EventBasicsStep` component for step 1
  - [ ] Create `ServiceRequirementsStep` component for step 2
  - [ ] Create `BudgetPlanningStep` component for step 3
  - [ ] Create `EventReviewStep` component for step 4
  - [ ] Create `ProgressBar` component for wizard progress
  - [ ] Create `EventTemplates` component for pre-built templates
  - [ ] Create `EventDraftManager` component for draft functionality
  - [ ] Create `EventVersionHistory` component for change tracking
  - [ ] Add form validation and error handling
- [ ] Implement step 1: Event basics (AC: 1, 5, 6, 8)
  - [ ] Create event type selection with predefined options
  - [ ] Add event date and time selection with validation
  - [ ] Implement location input with Mapbox autocomplete
  - [ ] Add attendee count input with validation
  - [ ] Create event duration selection
  - [ ] Add event description and special requirements
  - [ ] Implement form validation and error handling
  - [ ] Add progress saving and draft functionality
- [ ] Set up step 2: Service requirements (AC: 2, 5, 6, 8, 9)
  - [ ] Create service category selection
  - [ ] Add AI-powered service suggestions
  - [ ] Implement service requirement templates
  - [ ] Add custom service requirements input
  - [ ] Create service priority and importance indicators
  - [ ] Add service requirement validation
  - [ ] Implement contractor matching integration
  - [ ] Add service requirement customization
- [ ] Create step 3: Budget planning (AC: 3, 5, 6, 8)
  - [ ] Create overall budget input with recommendations
  - [ ] Add service-specific budget breakdowns
  - [ ] Implement budget adjustment and customization
  - [ ] Add historical pricing data integration
  - [ ] Create real-time pricing from contractor data
  - [ ] Add seasonal adjustments for pricing
  - [ ] Implement location-based cost variations
  - [ ] Add budget validation and warnings
- [ ] Implement step 4: Review and submit (AC: 4, 5, 6, 8, 9, 10, 11)
  - [ ] Create event details review interface
  - [ ] Add contractor matching results display
  - [ ] Implement event submission and validation
  - [ ] Add event creation confirmation
  - [ ] Create event editing after creation
  - [ ] Add change tracking and version history
  - [ ] Implement change notifications to contractors
  - [ ] Add event duplication for recurring events
- [ ] Set up event templates system (AC: 8)
  - [ ] Create pre-built event templates (weddings, corporate, parties)
  - [ ] Add template customization functionality
  - [ ] Implement template saving for users
  - [ ] Add template sharing and discovery
  - [ ] Create template validation and error handling
  - [ ] Add template analytics and usage tracking
  - [ ] Implement template version management
  - [ ] Add template recommendation system
- [ ] Create event management and editing (AC: 10, 11)
  - [ ] Create event editing interface
  - [ ] Add change tracking and version history
  - [ ] Implement change notifications to contractors
  - [ ] Add event status management
  - [ ] Create event duplication functionality
  - [ ] Add event deletion and restoration
  - [ ] Implement event sharing and collaboration
  - [ ] Add event analytics and insights
- [ ] Create event creation pages and navigation (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11)
  - [ ] Create `/events/create` page with event creation wizard
  - [ ] Create `/events/templates` page for event templates
  - [ ] Create `/events/{id}/edit` page for event editing
  - [ ] Create `/events/{id}/versions` page for version history
  - [ ] Add event creation navigation and breadcrumbs
  - [ ] Implement event creation routing and state management
  - [ ] Add event creation page metadata and SEO
  - [ ] Create event creation sharing and collaboration

## Dev Notes

### Previous Story Insights

This story builds on:

- **Story 1.1**: Project setup with Next.js and Supabase integration
- **Story 1.2**: Database schema with user tables and role management
- **Story 1.3**: Authentication system with role-based access
- **Story 1.4**: Basic user management with admin functionality
- **Story 1.5**: Basic UI framework and navigation
- **Story 2.1**: Event manager onboarding (for user context)
- **Story 2.2**: Contractor onboarding (for contractor data)
- **Story 2.3**: Profile management system (for profile data)
- **Story 2.4**: User verification workflow (for verified contractors)
- **Story 3.1**: Contractor directory display (for contractor data)
- **Story 3.2**: Advanced search & filtering (for search integration)
- **Story 3.3**: Contractor profile pages (for profile integration)
- **Story 3.4**: Search analytics & optimization (for analytics integration)
- **Story 4.1**: Interactive map implementation (for location services)
- **Story 4.2**: Map clustering & interaction (for map interactions)
- **Story 4.3**: Proximity filtering & search (for location services)
- **Story 4.4**: Basic admin features (for admin functionality)

The event creation wizard will use the existing contractor data, search systems, and location services to provide intelligent event planning.

### Data Models

[Source: architecture/data-models.md#user]
The event creation system will work with the following data models:

**User Table:**

- `id` UUID (references auth.users)
- `email` TEXT UNIQUE NOT NULL
- `role` user_role ENUM ('event_manager', 'contractor', 'admin')
- `is_verified` BOOLEAN DEFAULT FALSE
- `last_login` TIMESTAMP WITH TIME ZONE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()
- `updated_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Profile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `first_name` TEXT NOT NULL
- `last_name` TEXT NOT NULL
- `phone` TEXT
- `address` TEXT
- `profile_photo_url` TEXT
- `bio` TEXT
- `preferences` JSON

**Event Table (to be created):**

- `id` UUID PRIMARY KEY
- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `event_type` TEXT NOT NULL
- `title` TEXT NOT NULL
- `description` TEXT
- `event_date` TIMESTAMP WITH TIME ZONE NOT NULL
- `duration_hours` INTEGER
- `attendee_count` INTEGER
- `location` JSON
- `budget_total` DECIMAL(10,2)
- `status` event_status DEFAULT 'draft'
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()
- `updated_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**EventTemplate Table (to be created):**

- `id` UUID PRIMARY KEY
- `name` TEXT NOT NULL
- `event_type` TEXT NOT NULL
- `template_data` JSON NOT NULL
- `is_public` BOOLEAN DEFAULT FALSE
- `created_by` UUID REFERENCES users(id)
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**EventVersion Table (to be created):**

- `id` UUID PRIMARY KEY
- `event_id` UUID REFERENCES events(id) ON DELETE CASCADE
- `version_number` INTEGER NOT NULL
- `changes` JSON NOT NULL
- `created_by` UUID REFERENCES users(id)
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

### API Specifications

[Source: architecture/api-specification.md#event-endpoints]
The event creation system will implement the following API endpoints:

**Event Management:**

- `POST /api/events`

  - Body: `{ event_type, title, description, event_date, duration_hours, attendee_count, location, budget_total }`
  - Response: `{ event: Event, success: boolean }`

- `GET /api/events`

  - Query: `{ user_id?, status?, page?, limit? }`
  - Response: `{ events: Event[], total: number, page: number, limit: number }`

- `GET /api/events/{id}`

  - Response: `{ event: Event, versions: EventVersion[] }`

- `PUT /api/events/{id}`
  - Body: `{ event_type?, title?, description?, event_date?, duration_hours?, attendee_count?, location?, budget_total? }`
  - Response: `{ event: Event, success: boolean }`

**Event Templates:**

- `GET /api/events/templates`

  - Query: `{ event_type?, is_public? }`
  - Response: `{ templates: EventTemplate[] }`

- `POST /api/events/templates`
  - Body: `{ name, event_type, template_data, is_public? }`
  - Response: `{ template: EventTemplate, success: boolean }`

**Event Drafts:**

- `POST /api/events/drafts`

  - Body: `{ event_data: Partial<Event> }`
  - Response: `{ draft: EventDraft, success: boolean }`

- `GET /api/events/drafts`
  - Query: `{ user_id? }`
  - Response: `{ drafts: EventDraft[] }`

**Event Versions:**

- `GET /api/events/{id}/versions`

  - Response: `{ versions: EventVersion[] }`

- `POST /api/events/{id}/versions`
  - Body: `{ changes: JSON }`
  - Response: `{ version: EventVersion, success: boolean }`

### Component Specifications

[Source: architecture/components.md#feature-specific-components]
The event creation system will use the following components:

**Event Creation Components:**

- `EventCreationWizard` - Main 4-step event creation wizard
- `EventBasicsStep` - Step 1: Event basics form
- `ServiceRequirementsStep` - Step 2: Service requirements
- `BudgetPlanningStep` - Step 3: Budget planning
- `EventReviewStep` - Step 4: Review and submit
- `ProgressBar` - Wizard progress indicator
- `EventTemplates` - Pre-built event templates
- `EventDraftManager` - Draft management
- `EventVersionHistory` - Version history display
- `EventFormValidation` - Form validation
- `EventLocationInput` - Location input with Mapbox
- `EventDatePicker` - Date and time selection
- `EventTypeSelector` - Event type selection
- `ServiceCategorySelector` - Service category selection
- `BudgetInput` - Budget input and recommendations
- `ContractorMatchingResults` - Contractor matching display

**Wizard Features:**

- 4-step guided process with progress bar
- Form validation and error handling
- Draft saving and auto-save
- Pre-built event templates
- AI-powered service suggestions
- Budget planning and recommendations
- Contractor matching integration
- Change tracking and version history

### File Locations

[Source: architecture/components.md#component-hierarchy]
Based on the project structure guide:

- `app/events/create/page.tsx` - Event creation wizard page
- `app/events/templates/page.tsx` - Event templates page
- `app/events/[id]/edit/page.tsx` - Event editing page
- `app/events/[id]/versions/page.tsx` - Version history page
- `components/features/events/` - Event components
- `components/features/events/EventCreationWizard.tsx` - Main wizard
- `components/features/events/EventBasicsStep.tsx` - Step 1
- `components/features/events/ServiceRequirementsStep.tsx` - Step 2
- `components/features/events/BudgetPlanningStep.tsx` - Step 3
- `components/features/events/EventReviewStep.tsx` - Step 4
- `components/features/events/ProgressBar.tsx` - Progress bar
- `components/features/events/EventTemplates.tsx` - Templates
- `components/features/events/EventDraftManager.tsx` - Draft management
- `components/features/events/EventVersionHistory.tsx` - Version history
- `components/features/events/EventFormValidation.tsx` - Form validation
- `components/features/events/EventLocationInput.tsx` - Location input
- `components/features/events/EventDatePicker.tsx` - Date picker
- `components/features/events/EventTypeSelector.tsx` - Type selector
- `components/features/events/ServiceCategorySelector.tsx` - Service selector
- `components/features/events/BudgetInput.tsx` - Budget input
- `components/features/events/ContractorMatchingResults.tsx` - Matching results
- `lib/events/` - Event utilities and services
- `lib/events/event-service.ts` - Event service
- `lib/events/template-service.ts` - Template service
- `lib/events/draft-service.ts` - Draft service
- `lib/events/version-service.ts` - Version service
- `hooks/useEventCreation.ts` - Event creation hook
- `stores/event-creation.ts` - Event creation state management

### Technical Constraints

[Source: architecture/tech-stack.md + architecture/security.md]

- **Form Library**: React Hook Form with Zod validation
- **UI Library**: shadcn/ui with Tailwind CSS
- **State Management**: Zustand for event creation state
- **Validation**: Zod schemas for event data validation
- **Error Handling**: Comprehensive error types and user-friendly messages
- **Security**: Secure event data handling and validation
- **Performance**: Optimized form rendering and validation
- **Accessibility**: WCAG 2.1 AA compliance for form interactions

### Event Creation Wizard

**Wizard Features:**

- 4-step guided process with clear navigation
- Progress bar showing current step and completion
- Form validation with real-time feedback
- Draft saving and auto-save functionality
- Pre-built event templates with customization
- AI-powered service suggestions
- Budget planning with intelligent recommendations
- Contractor matching integration

**Wizard Implementation:**

```typescript
// Example wizard state management
interface EventCreationWizardState {
  currentStep: number;
  eventData: Partial<Event>;
  serviceRequirements: ServiceRequirement[];
  budgetPlan: BudgetPlan;
  contractorMatches: ContractorMatch[];
  isDraft: boolean;
  validationErrors: ValidationError[];
  nextStep: () => void;
  previousStep: () => void;
  updateEventData: (data: Partial<Event>) => void;
  saveDraft: () => Promise<void>;
  submitEvent: () => Promise<void>;
}
```

### Event Templates

**Template Features:**

- Pre-built templates for common event types
- Template customization and personalization
- Template saving and sharing
- Template discovery and recommendations
- Template version management
- Template analytics and usage tracking

**Template Implementation:**

- Wedding templates with service categories
- Corporate event templates
- Party and celebration templates
- Custom template creation
- Template sharing and collaboration
- Template validation and error handling

### Form Validation

**Validation Features:**

- Real-time form validation with Zod schemas
- Field-level validation with error messages
- Step-level validation before progression
- Event data validation and sanitization
- Location validation with Mapbox
- Date and time validation
- Budget validation and warnings

**Validation Implementation:**

- Zod schemas for each wizard step
- Real-time validation feedback
- Error message display and handling
- Form submission validation
- Data sanitization and cleaning

### Testing

[Source: architecture/testing.md#testing-strategy]
**Testing Standards:**

- **Component Testing**: Jest + React Testing Library for event components
- **API Testing**: Jest + Supertest for event endpoints
- **E2E Testing**: Playwright for complete event creation flows
- **Form Testing**: Test form validation and submission
- **Wizard Testing**: Test wizard navigation and state management
- **Test File Location**: `__tests__/events/` directory
- **Test Scenarios**: Event creation, template usage, form validation, wizard navigation, draft saving
- **Coverage Requirements**: 80% coverage for event logic and components

### Performance Considerations

**Event Creation Performance:**

- Optimized form rendering and validation
- Efficient wizard state management
- Draft auto-save optimization
- Template loading and caching
- Contractor matching performance
- Mobile performance optimization

**Data Management:**

- Event data caching and persistence
- Draft data management
- Template data caching
- Version history optimization
- Real-time updates optimization

### State Management

[Source: architecture/components.md#state-management-architecture]
**Event Creation State Management:**

```typescript
interface EventCreationStore {
  currentStep: number;
  eventData: Partial<Event>;
  serviceRequirements: ServiceRequirement[];
  budgetPlan: BudgetPlan;
  contractorMatches: ContractorMatch[];
  templates: EventTemplate[];
  drafts: EventDraft[];
  isDraft: boolean;
  isLoading: boolean;
  validationErrors: ValidationError[];
  nextStep: () => void;
  previousStep: () => void;
  updateEventData: (data: Partial<Event>) => void;
  addServiceRequirement: (requirement: ServiceRequirement) => void;
  removeServiceRequirement: (id: string) => void;
  updateBudgetPlan: (plan: BudgetPlan) => void;
  loadTemplates: (eventType?: string) => Promise<void>;
  loadDrafts: () => Promise<void>;
  saveDraft: () => Promise<void>;
  submitEvent: () => Promise<void>;
  validateStep: (step: number) => boolean;
}
```

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2024-09-22 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
