# Story 3.3: Contractor Profile Pages

## Status

Draft

## Story

**As an** event manager,  
**I want** to view detailed contractor profiles,  
**so that** I can evaluate their suitability for my event needs.

## Acceptance Criteria

1. Comprehensive contractor profile layout
2. Business information display (name, description, service areas)
3. Portfolio gallery with past event photos
4. Service listings with detailed descriptions
5. Pricing information and package options
6. Testimonials and review display
7. Contact information and inquiry form
8. Social proof and verification badges
9. Public profiles (viewable without login)
10. Authentication required for "Get in touch" functionality
11. Integration with inquiry system

## Tasks / Subtasks

- [ ] Create contractor profile API routes (AC: 1, 2, 3, 4, 5, 6, 7, 9, 10, 11)
  - [ ] Implement `/api/contractors/{id}/profile` endpoint for full profile data
  - [ ] Implement `/api/contractors/{id}/portfolio` endpoint for portfolio gallery
  - [ ] Implement `/api/contractors/{id}/services` endpoint for service listings
  - [ ] Implement `/api/contractors/{id}/reviews` endpoint for testimonials
  - [ ] Implement `/api/contractors/{id}/contact` endpoint for inquiry form
  - [ ] Implement `/api/contractors/{id}/verification` endpoint for verification status
  - [ ] Add proper public access controls and authentication requirements
- [ ] Build contractor profile UI components (AC: 1, 2, 3, 4, 5, 6, 7, 8, 10)
  - [ ] Create `ContractorProfile` component with comprehensive layout
  - [ ] Create `BusinessInfoSection` component for business information
  - [ ] Create `PortfolioGallery` component for past event photos
  - [ ] Create `ServicesSection` component for service listings
  - [ ] Create `PricingSection` component for pricing information
  - [ ] Create `TestimonialsSection` component for reviews display
  - [ ] Create `ContactSection` component for inquiry form
  - [ ] Create `VerificationBadges` component for social proof
  - [ ] Add responsive design and mobile optimization
- [ ] Implement portfolio gallery system (AC: 3)
  - [ ] Create portfolio photo gallery with lightbox functionality
  - [ ] Add portfolio image optimization and lazy loading
  - [ ] Implement portfolio filtering and categorization
  - [ ] Add portfolio image captions and descriptions
  - [ ] Create portfolio sharing and social media integration
- [ ] Set up service listings display (AC: 4, 5)
  - [ ] Create service cards with detailed descriptions
  - [ ] Add service pricing and package options
  - [ ] Implement service availability indicators
  - [ ] Add service category organization
  - [ ] Create service comparison functionality
- [ ] Implement testimonials and reviews system (AC: 6)
  - [ ] Create testimonial cards with star ratings
  - [ ] Add review filtering and sorting options
  - [ ] Implement review pagination and infinite scroll
  - [ ] Add review verification and authenticity indicators
  - [ ] Create review response system for contractors
- [ ] Set up contact and inquiry functionality (AC: 7, 10, 11)
  - [ ] Create inquiry form with validation
  - [ ] Add contact information display with privacy controls
  - [ ] Implement inquiry submission and tracking
  - [ ] Add inquiry response notifications
  - [ ] Create inquiry management system
- [ ] Create contractor profile pages and navigation (AC: 1, 9)
  - [ ] Create `/contractors/[id]` page with full profile display
  - [ ] Add profile page navigation and breadcrumbs
  - [ ] Implement profile page routing and guards
  - [ ] Add profile page metadata and SEO optimization
  - [ ] Create profile sharing and social media integration
- [ ] Implement verification badges and social proof (AC: 8)
  - [ ] Create verification status indicators
  - [ ] Add business registration badges (NZBN)
  - [ ] Implement portfolio quality indicators
  - [ ] Add response time badges
  - [ ] Create premium profile indicators
- [ ] Set up public access and authentication (AC: 9, 10)
  - [ ] Implement public profile viewing without login
  - [ ] Add authentication requirements for contact features
  - [ ] Create guest user experience optimization
  - [ ] Add login prompts for authenticated features
  - [ ] Implement profile access analytics

## Dev Notes

### Previous Story Insights

This story builds on:

- **Story 1.1**: Project setup with Next.js and Supabase integration
- **Story 1.2**: Database schema with user tables and role management
- **Story 1.3**: Authentication system with role-based access
- **Story 1.4**: Basic user management with admin functionality
- **Story 1.5**: Basic UI framework and navigation
- **Story 2.1**: Event manager onboarding (for user context)
- **Story 2.2**: Contractor onboarding (for contractor data)
- **Story 2.3**: Profile management system (for profile data)
- **Story 2.4**: User verification workflow (for verification status)
- **Story 3.1**: Contractor directory display (for directory integration)
- **Story 3.2**: Advanced search & filtering (for search integration)

The contractor profile pages will use the existing database schema and verification system to display comprehensive contractor information for event manager evaluation.

### Data Models

[Source: architecture/data-models.md#user]
The contractor profile system will work with the following data models:

**User Table:**

- `id` UUID (references auth.users)
- `email` TEXT UNIQUE NOT NULL
- `role` user_role ENUM ('event_manager', 'contractor', 'admin')
- `is_verified` BOOLEAN DEFAULT FALSE
- `last_login` TIMESTAMP WITH TIME ZONE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()
- `updated_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Profile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `first_name` TEXT NOT NULL
- `last_name` TEXT NOT NULL
- `phone` TEXT
- `address` TEXT
- `profile_photo_url` TEXT
- `bio` TEXT
- `preferences` JSON

**BusinessProfile Table:**

- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `company_name` TEXT NOT NULL
- `business_address` TEXT
- `nzbn` TEXT
- `description` TEXT
- `service_areas` TEXT[]
- `social_links` JSON
- `is_verified` BOOLEAN DEFAULT FALSE
- `verification_date` TIMESTAMP WITH TIME ZONE
- `subscription_tier` subscription_tier DEFAULT 'essential'

**Portfolio Table:**

- `id` UUID PRIMARY KEY
- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `title` TEXT NOT NULL
- `description` TEXT
- `image_url` TEXT
- `video_url` TEXT
- `video_platform` TEXT
- `event_date` DATE
- `is_visible` BOOLEAN DEFAULT TRUE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Service Table:**

- `id` UUID PRIMARY KEY
- `user_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `service_type` TEXT NOT NULL
- `description` TEXT
- `price_range_min` DECIMAL(10,2)
- `price_range_max` DECIMAL(10,2)
- `availability` TEXT
- `is_visible` BOOLEAN DEFAULT TRUE
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Review Table:**

- `id` UUID PRIMARY KEY
- `contractor_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `event_manager_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `rating` INTEGER CHECK (rating >= 1 AND rating <= 5)
- `comment` TEXT
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

**Inquiry Table (to be created):**

- `id` UUID PRIMARY KEY
- `contractor_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `event_manager_id` UUID REFERENCES users(id) ON DELETE CASCADE
- `subject` TEXT NOT NULL
- `message` TEXT NOT NULL
- `status` TEXT DEFAULT 'pending'
- `created_at` TIMESTAMP WITH TIME ZONE DEFAULT NOW()

### API Specifications

[Source: architecture/api-specification.md#contractor-endpoints]
The contractor profile system will implement the following API endpoints:

**Contractor Profile:**

- `GET /api/contractors/{id}/profile`

  - Response: `{ contractor: Contractor, profile: Profile, business_profile: BusinessProfile, verification_status: VerificationStatus }`

- `GET /api/contractors/{id}/portfolio`

  - Query: `{ page?, limit?, category? }`
  - Response: `{ portfolio: PortfolioItem[], total: number, page: number, limit: number }`

- `GET /api/contractors/{id}/services`

  - Response: `{ services: Service[] }`

- `GET /api/contractors/{id}/reviews`

  - Query: `{ page?, limit?, rating? }`
  - Response: `{ reviews: Review[], total: number, average_rating: number }`

- `GET /api/contractors/{id}/verification`
  - Response: `{ verification_status: VerificationStatus, badges: Badge[] }`

**Inquiry System:**

- `POST /api/contractors/{id}/inquiry`

  - Body: `{ subject, message }`
  - Response: `{ inquiry: Inquiry }`

- `GET /api/inquiries`
  - Response: `{ inquiries: Inquiry[] }`

### Component Specifications

[Source: architecture/components.md#feature-specific-components]
The contractor profile system will use the following components:

**Profile Components:**

- `ContractorProfile` - Main profile page layout
- `BusinessInfoSection` - Business information display
- `PortfolioGallery` - Portfolio photo gallery
- `ServicesSection` - Service listings display
- `PricingSection` - Pricing information display
- `TestimonialsSection` - Reviews and testimonials
- `ContactSection` - Contact form and information
- `VerificationBadges` - Verification status indicators
- `InquiryForm` - Contact inquiry form
- `ProfileHeader` - Profile header with key information

**Gallery Features:**

- Lightbox functionality for portfolio images
- Image optimization and lazy loading
- Portfolio filtering and categorization
- Social media sharing integration
- Mobile-optimized gallery layout

### File Locations

[Source: architecture/components.md#component-hierarchy]
Based on the project structure guide:

- `app/contractors/[id]/page.tsx` - Contractor profile page
- `components/features/contractors/profile/` - Profile page components
- `components/features/contractors/profile/ContractorProfile.tsx` - Main profile
- `components/features/contractors/profile/BusinessInfoSection.tsx` - Business info
- `components/features/contractors/profile/PortfolioGallery.tsx` - Portfolio gallery
- `components/features/contractors/profile/ServicesSection.tsx` - Services section
- `components/features/contractors/profile/PricingSection.tsx` - Pricing section
- `components/features/contractors/profile/TestimonialsSection.tsx` - Testimonials
- `components/features/contractors/profile/ContactSection.tsx` - Contact section
- `components/features/contractors/profile/VerificationBadges.tsx` - Verification badges
- `components/features/contractors/profile/InquiryForm.tsx` - Inquiry form
- `lib/contractors/profile/` - Profile utilities and services
- `lib/contractors/profile/profile-service.ts` - Profile service
- `lib/contractors/profile/portfolio-service.ts` - Portfolio service
- `lib/contractors/profile/inquiry-service.ts` - Inquiry service
- `hooks/useContractorProfile.ts` - Profile data hook
- `stores/contractor-profile.ts` - Profile state management

### Technical Constraints

[Source: architecture/tech-stack.md + architecture/security.md]

- **Authentication**: Public access for profile viewing, authenticated for contact features
- **Performance**: Optimized image loading and lazy loading
- **Security**: Input validation and sanitization for inquiry forms
- **Validation**: Client-side with React Hook Form + Zod, server-side validation
- **Error Handling**: Comprehensive error types and user-friendly messages
- **SEO**: Proper metadata and structured data for search engines
- **Accessibility**: WCAG 2.1 AA compliance for all profile components

### Portfolio Gallery Implementation

**Gallery Features:**

- Lightbox with image navigation
- Image optimization and compression
- Lazy loading for performance
- Mobile-responsive gallery layout
- Social media sharing integration
- Portfolio filtering by category

**Image Optimization:**

- Next.js Image component integration
- WebP format support with fallbacks
- Responsive image sizing
- Lazy loading with intersection observer
- Progressive image loading

### Inquiry System

**Inquiry Features:**

- Contact form with validation
- Inquiry tracking and status updates
- Email notifications for contractors
- Inquiry response system
- Inquiry history and management

**Form Validation:**

- Required field validation
- Email format validation
- Message length validation
- Spam protection and rate limiting
- Success and error feedback

### Verification Badges

**Badge Types:**

- Business verification badge
- NZBN registration badge
- Portfolio quality badge
- Response time badge
- Premium profile badge
- Review rating badge

**Badge Display:**

- Visual indicators with tooltips
- Badge hierarchy and importance
- Mobile-optimized badge layout
- Accessibility-compliant badges

### Testing

[Source: architecture/testing.md#testing-strategy]
**Testing Standards:**

- **Component Testing**: Jest + React Testing Library for profile components
- **API Testing**: Jest + Supertest for profile endpoints
- **E2E Testing**: Playwright for complete profile viewing flows
- **Image Testing**: Test portfolio gallery and image optimization
- **Form Testing**: Test inquiry form functionality and validation
- **Test File Location**: `__tests__/contractors/profile/` directory
- **Test Scenarios**: Profile display, portfolio gallery, service listings, testimonials, inquiry form
- **Coverage Requirements**: 80% coverage for profile page logic and components

### Performance Considerations

**Profile Page Optimization:**

- Image optimization and lazy loading
- Code splitting for profile sections
- Caching for frequently accessed profiles
- Optimized database queries
- Progressive enhancement

**Gallery Performance:**

- Lazy loading for portfolio images
- Image compression and optimization
- Efficient gallery navigation
- Mobile performance optimization
- Bandwidth-conscious loading

### State Management

[Source: architecture/components.md#state-management-architecture]
**Contractor Profile State Management:**

```typescript
interface ContractorProfileStore {
  contractor: Contractor | null;
  profile: Profile | null;
  businessProfile: BusinessProfile | null;
  portfolio: PortfolioItem[];
  services: Service[];
  reviews: Review[];
  verificationStatus: VerificationStatus;
  isLoading: boolean;
  fetchContractorProfile: (id: string) => Promise<void>;
  fetchPortfolio: (id: string, filters?: PortfolioFilters) => Promise<void>;
  fetchServices: (id: string) => Promise<void>;
  fetchReviews: (id: string, filters?: ReviewFilters) => Promise<void>;
  submitInquiry: (contractorId: string, inquiry: InquiryData) => Promise<void>;
  refreshProfile: () => Promise<void>;
}
```

## Change Log

| Date       | Version | Description            | Author       |
| ---------- | ------- | ---------------------- | ------------ |
| 2024-09-22 | 1.0     | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
